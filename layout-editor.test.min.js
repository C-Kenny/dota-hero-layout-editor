ko.bindingHandlers.spinner={init:function(c,d,e,b){var a=e().spinnerOptions||{};$(c).spinner(a);ko.utils.registerEventHandler(c,"spinstart",function(f,g){b.cards.state="spinning";b.cards.saveSelectedState();if(g.value==null){return}var h=d();h(g.value)});ko.utils.registerEventHandler(c,"spin",function(f,g){if(g.value==null){return}var h=d();h(g.value)});ko.utils.registerEventHandler(c,"spinchange",function(){if($(c).spinner("value")==null){return}var f=d();f($(c).spinner("value"))});ko.utils.registerEventHandler(c,"spinstop",function(f,g){if(b.cards.state=="spinning"){b.cards.state=null}if(g.value==null){return}var h=d();h(g.value)});ko.utils.domNodeDisposal.addDisposeCallback(c,function(){$(c).spinner("destroy")})},update:function(a,b){var c=ko.utils.unwrapObservable(b()),d=$(a).spinner("value");if(c!==d){$(a).spinner("value",c)}}};ko.extenders.numeric=function(c,b){var a=ko.pureComputed({read:c,write:function(g){var f=c(),e=Math.pow(10,b),h=isNaN(g)?0:parseFloat(+g),d=Math.round(h*e)/e;if(d!==f){c(d)}else{if(g!==f){c.notifySubscribers(d)}}}}).extend({notify:"always"});a(c());return a};(function(){function i(t,p,r,s,v,u,q,w){var z=this;this.collection=t;this.selected=ko.observable(false);this.selected.subscribe(function(x){if(x){$(z.$imgDraggable).addClass("ui-state-highlight")}else{$(z.$imgDraggable).removeClass("ui-state-highlight")}z.collection.updateSelected()});this.name=p.replace("npc_dota_hero_","");this.displayname=r;this.HeroID=s;this.width=this.collection.cardWidth();this.height=this.collection.cardHeight();this.x=ko.observable(v-q*this.width/2+this.width/2||0);this.y=ko.observable(u-q*this.height/2+this.height/2||0);this.defaultScale=1;this.scale=ko.observable(q||this.defaultScale);this.scaleStart=0;this.dragStartPos={top:0,left:0};this.zpos=ko.observable(w||100);this.zpos.subscribe(function(x){z.$imgDraggable.css("zIndex",x)});var o="/media/images/heroes/selection/npc_dota_hero_"+this.name+".png";this.snapped=ko.observable(false);this.snapped.subscribe(function(x){if(x){z.setGrid([z.collection.gridWidth(),z.collection.gridHeight()]);$(z.$img).addClass("card-snapped")}else{z.setGrid(false);$(z.$img).removeClass("card-snapped")}});this.$imgDraggable=$("<div>").addClass("card").css("zIndex",this.zpos()).css("position","absolute").width(this.width*this.scale()).height(this.height*this.scale()).draggable({containment:"#container",grid:false,start:function(x,A){z.collection.state="dragging";z.selected(true);z.dragStartPos.top=A.position.top;z.dragStartPos.left=A.position.left;var y=[];$(".ui-state-highlight").each(function(B){if(this!=z.$imgDraggable[0]){this.card.dragStartPos.top=parseFloat($(this).css("top"))||0;this.card.dragStartPos.left=parseFloat($(this).css("left"))||0}y.push(this.card.getState())});z.collection.future.length=0;z.collection.history.push(y);z.collection.historyCount(z.collection.history.length)},drag:function(x,y){$(".ui-state-highlight").each(function(A){if(this!=z.$imgDraggable[0]){$(this).css({top:this.card.dragStartPos.top+(y.position.top-z.dragStartPos.top),left:this.card.dragStartPos.left+(y.position.left-z.dragStartPos.left)})}})},stop:function(x,y){z.disableSetXY=true;z.x($(this).position().left-z.collection.$grid.offset().left);z.y($(this).position().top-z.collection.$grid.offset().top);z.disableSetXY=false;z.setXY();$(".ui-state-highlight").each(function(A){if(this!=z.$imgDraggable[0]){this.card.x($(this).position().left-this.card.collection.$grid.offset().left);this.card.y($(this).position().top-this.card.collection.$grid.offset().top)}});if(z.collection.state=="dragging"){z.collection.state=null}}}).mousedown(function(x){z.collection.state="clicking";if(z.selected()){z.selected(false)}else{if(!x.shiftKey&&!x.ctrlKey&&!z.collection.swap()){z.collection.selectAll(false)}z.selected(true)}x.stopPropagation();if(z.collection.state=="clicking"){z.collection.state=null}});this.$imgResizable=$("<div>").addClass("card-resize").width(this.width*this.scale()).height(this.height*this.scale()).resizable({aspectRatio:true,handles:"se",start:function(x,A){z.collection.state="resizing";z.selected(true);var y=[];$(".ui-state-highlight .card-resize").each(function(B){if(this!=z.$imgResizable[0]){this.card.scaleStart=this.card.scale()}y.push(this.card.getState())});z.collection.future.length=0;z.collection.history.push(y);z.collection.historyCount(z.collection.history.length)},resize:function(x,y){z.$imgDraggable.width(z.width*(z.$imgResizable.width()/z.width)).height(z.height*(z.$imgResizable.width()/z.width));$(".ui-state-highlight .card-resize").each(function(A){if(this!=z.$imgResizable[0]){this.card.scale(this.card.scaleStart*(z.$imgResizable.width()/z.width)/z.scale());this.card.resize()}})},stop:function(x,y){z.scale(z.$imgResizable.width()/z.width);z.resize();if(z.collection.state=="resizing"){z.collection.state=null}}});this.$img=$("<img>").addClass("card-image").attr("src",o).width("100%").height("100%");this.$imgDraggable[0].card=z;this.$imgResizable[0].card=z;this.$imgDraggable.append(this.$imgResizable);this.$imgResizable.append(this.$img);this.disableSetXY=false;this.setXY()}i.prototype.getState=function(){return{HeroID:this.HeroID,x:this.x(),y:this.y(),scale:this.scale(),zpos:this.zpos(),grid:this.$imgDraggable.draggable("option","grid"),snapped:this.snapped(),selected:this.selected()}};i.prototype.loadState=function(o){this.snapped(o.snapped);this.x(o.x);this.y(o.y);this.scale(o.scale);this.zpos(o.zpos);this.$imgDraggable.draggable("option","grid",o.grid);this.selected(o.selected);this.setXY();this.resize()};i.prototype.getX=function(){return(this.x()+this.$imgDraggable.width()/2-this.width/2)/this.collection.ratioX()};i.prototype.getY=function(){return(this.y()+this.$imgDraggable.height()/2-this.height/2)/this.collection.ratioY()};i.prototype.draggable=function(o){this.$imgDraggable.draggable(o?"enable":"disable")};i.prototype.resizable=function(o){this.$imgResizable.resizable(o?"enable":"disable")};i.prototype.destroy=function(){this.$imgDraggable.remove();this.$imgResizable.remove();this.$img.remove()};i.prototype.setXY=function(){if(this.disableSetXY){return}this.$imgDraggable.css({top:this.collection.$grid.offset().top+this.y(),left:this.collection.$grid.offset().left+this.x()})};i.prototype.setGrid=function(o){this.$imgDraggable.draggable("option","grid",o)};i.prototype.resize=function(){this.$imgDraggable.width(this.width*this.scale()).height(this.height*this.scale());this.$imgResizable.width(this.width*this.scale()).height(this.height*this.scale())};i.prototype.reset=function(){this.scale(this.defaultScale);this.resize()};i.prototype.snap=function(){if(this.x()%this.collection.gridWidth()<this.collection.gridWidth()/2){this.x(this.x()-this.x()%this.collection.gridWidth())}else{this.x(this.x()+this.collection.gridWidth()-(this.x()%this.collection.gridWidth()))}if(this.y()%this.collection.gridHeight()<this.collection.gridHeight()/2){this.y(this.y()-this.y()%this.collection.gridHeight())}else{this.y(this.y()+this.collection.gridHeight()-(this.y()%this.collection.gridHeight()))}this.setXY()};function f(o,v,u,t,r,p,s,q){var w=this;this.cardWidth=ko.observable(s);this.cardHeight=ko.observable(q);this.layoutWidth=ko.observable(u);this.layoutHeight=ko.observable(t);this.width=ko.observable(o);this.height=ko.observable(v);this.ratioX=ko.computed(function(){return w.width()/w.layoutWidth()});this.ratioY=ko.computed(function(){return w.height()/w.layoutHeight()});this.gridWidth=ko.observable(r||25).extend({numeric:0});this.gridHeight=ko.observable(p||25).extend({numeric:0});this.$grid=$("#container").css("zIndex",-100).width(this.width()).height(this.height());this.aspectRatio=ko.observable("16x9");this.aspectRatio.subscribe(function(x){w.changeAspectRatio.apply(w,d[x])});$(document).keydown(function(x){if($(".controls input[type=text]").is(":focus")){return}if(x.ctrlKey){switch(x.which){case 65:w.selectAll(true);break}}else{switch(x.which){case 74:w.decreaseDepth();break;case 75:w.increaseDepth();break;case 82:w.resetSelected();break;case 84:w.gridShow(!w.gridShow());break;case 71:w.swap(!w.swap());break;case 65:w.nudgeSelected(-1,0);break;case 83:w.nudgeSelected(0,1);break;case 68:w.nudgeSelected(1,0);break;case 87:w.nudgeSelected(0,-1);break;case 86:w.nudgeScaleSelected(-0.1);break;case 67:w.nudgeScaleSelected(0.1);break;case 66:w.swapSelection();break;case 70:if(w.selection().length>0){if(w.selection()[0].snapped()){w.unsnapSelection()}else{w.snapSelection()}}break;case 69:if(w.downloadLink!=""){$("#download-link").fadeOut().fadeIn()}w.downloadLink(m(w.toLayoutVMF()));break;case 81:if(w.shareId!=""){$("#share-link").fadeOut().fadeIn()}w.share();break;case 90:w.undo();break;case 88:w.redo();break}}});this.$ghostSelect=$('<div class="ghost-select"><span></span></div>');this.$grid.append(this.$ghostSelect);this.canvas=document.createElement("canvas");this.canvas.style.position="absolute";this.canvas.width=this.width();this.canvas.height=this.height();this.ctx=this.canvas.getContext("2d");this.$grid.append(this.canvas);this.sizeChanged=ko.computed(function(){w.canvas.width=w.width();w.canvas.height=w.height();w.$grid.width(w.width()).height(w.height());w.drawGridLines()});this.gridShow=ko.observable(true);this.gridShow.subscribe(function(x){if(x){w.drawGridLines()}else{w.ctx.clearRect(0,0,w.canvas.width,w.canvas.height)}});this.gridChanged=ko.computed(function(){});this.gridChangeEmitter=ko.observable(0);this.gridListener=ko.computed(function(){w.gridWidth();w.gridHeight();w.gridChangeEmitter((w.gridChangeEmitter()+1)%10)});this.gridChangeEmitter.subscribe(function(y){if(w.modifyingState){return}var x=[];x.gridWidth=w.gridWidth();x.gridHeight=w.gridHeight();w.snapped().map(function(z){x.push(z.getState());z.setGrid([w.gridWidth(),w.gridHeight()]);z.snap()});w.future.length=0;w.history.push(x);w.historyCount(w.history.length)});this.swap=ko.observable(false);this.swap.subscribe(function(x){if(x){w.selectAll(false)}w.draggable(!x);w.resizable(!x)});this.historyCount=ko.observable(0);this.selectedCount=ko.observable(0);this.selectedCard=ko.observable(null);this.downloadLink=ko.observable("");this.shareId=ko.observable("");this.history=[];this.future=[];this.modifyingState=false;this.state=null;this.search=ko.observable("");this.search.subscribe(function(x){w.state="selecting";w.disableUpdateSelected=true;if(!x){w.selectAll(false);return}w.map(function(y){if(y.name.toLowerCase().indexOf(x.toLowerCase())==0||y.displayname.toLowerCase().indexOf(x.toLowerCase())==0){y.selected(true)}else{y.selected(false)}});w.disableUpdateSelected=false;w.updateSelected();if(w.state="selecting"){w.state=null}})}f.prototype=Object.create(Array.prototype);f.prototype.constructor=f;f.prototype.empty=function(){while(this.length>0){var o=this.pop();o.destroy()}};f.prototype.changeAspectRatio=function(o,w,v,u,s,p,t,r){var x=this;this.cardWidth(t);this.cardHeight(r);this.layoutWidth(v);this.layoutHeight(u);this.width(o);this.height(w);this.gridWidth(s);this.gridHeight(p);var q=n("id");if(q){$.get("save/"+q+".txt",function(y){x.parseVMF(y)})}else{$.get("default_"+this.aspectRatio()+".txt",function(y){x.parseVMF(y)})}};f.prototype.getHeroID=function(o){for(var p=0;p<this.length;p++){if(this[p].HeroID==o){return this[p]}}return null};f.prototype.getName=function(o){var q=o.replace("npc_dota_hero_","");for(var p=0;p<this.length;p++){if(this[p].name==q){return this[p]}}return null};f.prototype.drawGridLines=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.beginPath();this.ctx.rect(0,0,this.canvas.width,this.canvas.height);this.ctx.lineWidth=1;this.ctx.strokeStyle="#ff0000";this.ctx.stroke();for(var o=0;o<=Math.floor(this.canvas.width/this.gridWidth());o++){this.ctx.beginPath();this.ctx.moveTo(o*this.gridWidth(),0);this.ctx.lineTo(o*this.gridWidth(),this.canvas.height);this.ctx.strokeStyle="#000000";this.ctx.stroke()}for(var o=0;o<=Math.floor(this.canvas.height/this.gridHeight());o++){this.ctx.beginPath();this.ctx.moveTo(0,o*this.gridHeight());this.ctx.lineTo(this.canvas.width,o*this.gridHeight());this.ctx.strokeStyle="#000000";this.ctx.stroke()}};f.prototype.setGrid=function(o){this.snapped().map(function(p){p.setGrid(o)})};f.prototype.undo=function(){if(this.history.length>0){this.state="undoing";this.modifyingState=true;this.swap(false);var o=this.history.pop();var r=[];r.gridWidth=this.gridWidth();r.gridHeight=this.gridHeight();if(o.gridWidth!=undefined){this.gridWidth(o.gridWidth)}if(o.gridHeight!=undefined){this.gridHeight(o.gridHeight)}for(var q=0;q<o.length;q++){var p=this.getHeroID(o[q].HeroID);r.push(p.getState());p.loadState(o[q])}this.future.push(r);this.modifyingState=false;if(this.state=="undoing"){this.state=null}}};f.prototype.redo=function(){if(this.future.length>0){this.state="redoing";this.modifyingState=true;this.swap(false);var o=this.future.pop();var r=[];r.gridWidth=this.gridWidth();r.gridHeight=this.gridHeight();if(o.gridWidth!=undefined){this.gridWidth(o.gridWidth)}if(o.gridHeight!=undefined){this.gridHeight(o.gridHeight)}for(var q=0;q<o.length;q++){var p=this.getHeroID(o[q].HeroID);r.push(p.getState());p.loadState(o[q])}this.history.push(r);this.modifyingState=false;if(this.state=="redoing"){this.state=null}}};f.prototype.clearHistory=function(){this.history.length=0;this.future.length=0;this.historyCount(0)};f.prototype.applyAction=function(r,q,o){this.state=q;var p=[];r.map(function(s){p.push(s.getState());o(s)});this.future.length=0;if(p.length>0){this.history.push(p)}this.historyCount(this.history.length);if(this.state==q){this.state=null}};f.prototype.increaseDepth=function(){this.applyAction(this.selection(),"increasingDepth",function(o){o.zpos(o.zpos()+1)})};f.prototype.decreaseDepth=function(){this.applyAction(this.selection(),"decreasingDepth",function(o){o.zpos(o.zpos()-1)})};f.prototype.nudgeSelected=function(o,q){var p=this;this.applyAction(this.selection(),"nudging",function(r){if(o!=0){r.x(r.x()+o*(r.snapped()?p.gridWidth():1))}if(q!=0){r.y(r.y()+q*(r.snapped()?p.gridHeight():1))}r.setXY()})};f.prototype.nudgeScaleSelected=function(o){this.applyAction(this.selection(),"nudgingScale",function(p){p.scale(p.scale()+o);p.resize()})};f.prototype.resetSelected=function(){this.applyAction(this.selection(),"resetting",function(o){o.reset()})};f.prototype.selectAll=function(o){this.disableUpdateSelected=true;this.map(function(p){p.selected(o)});if(!o){this.search("")}this.selectedCount(o?this.length:0);this.selectedCard(null);this.disableUpdateSelected=false};f.prototype.selection=function(){return this.filter(function(o){return o.selected()})};f.prototype.snapped=function(){return this.filter(function(o){return o.snapped()})};f.prototype.swapSelection=function(){if(this.selectedCount()==2){var q=-1,p=-1;for(var o=0;o<this.length;o++){if(this[o].selected()){if(q==-1){q=o}else{if(p==-1){p=o}}}}this.doSwap(q,p)}};f.prototype.snapSelection=function(){this.applyAction(this.selection(),"snapping",function(o){o.snapped(true);o.snap()})};f.prototype.unsnapSelection=function(){this.applyAction(this.selection(),"unsnapping",function(o){o.snapped(false)})};f.prototype.setSelectedProperty=function(q,p){var o=[];this.selection().map(function(r){r[q](p);if(q=="x"||q=="y"){r.setXY()}if(q=="scale"){r.resize()}})};f.prototype.draggable=function(o){this.map(function(p){p.draggable(o)})};f.prototype.resizable=function(o){this.map(function(p){p.resizable(o)})};f.prototype.parseVMF=function(C){var v=Object.keys(k);this.empty();var q=C.split("\n").map(function(x){return x.trim(" \t")});var p=0;for(var r=0;r<q.length;r++){var A,s,t,z,w,o,B;if(q[r]=="{"){p++}else{if(q[r]=="}"){p--;if(p==1){this.add(A,s,t,z,w,o,B);v.splice(v.indexOf(t.toString()),1)}}else{if(p==2){if(q[r].indexOf('"HeroID"')>-1){t=parseFloat(q[r].replace("HeroID","").replace(/"/g,""));A=k[t].name;s=k[t].displayname}else{if(q[r].indexOf('"x"')>-1){z=(parseFloat(q[r].replace("x","").replace(/"/g,""))-d[this.aspectRatio()][10])*this.ratioX()}else{if(q[r].indexOf('"y"')>-1){w=parseFloat(q[r].replace("y","").replace(/"/g,""))*this.ratioY()}else{if(q[r].indexOf('"scale"')>-1){o=parseFloat(q[r].replace("scale","").replace(/"/g,""))/d[this.aspectRatio()][11]}else{if(q[r].indexOf('"zpos"')>-1){B=parseFloat(q[r].replace("zpos","").replace(/"/g,""))}}}}}}}}}for(var r=0;r<v.length;r++){var u=k[v[r]];this.add(u.name,u.displayname,u.HeroID)}this.future.length=0;this.history.length=0;this.historyCount(0)};f.prototype.toLayoutVMF=function(){var o='"fulldeck_layout.txt"\n';o+="{\n";for(var p=0;p<this.length;p++){o+='\t\t"'+p+'"\n';o+="\t\t{\n";o+='\t\t\t\t"HeroID"\t\t\t\t"'+this[p].HeroID+'"\n';o+='\t\t\t\t"x"\t\t\t\t"'+(this[p].getX()+d[this.aspectRatio()][10])+'"\n';o+='\t\t\t\t"y"\t\t\t\t"'+this[p].getY()+'"\n';o+='\t\t\t\t"scale"\t\t\t\t"'+this[p].scale()*d[this.aspectRatio()][11]+'"\n';o+='\t\t\t\t"zpos"\t\t\t\t"'+(this[p].zpos())+'"\n';o+="\t\t}\n"}o+="}\n";return o};f.prototype.add=function(s,r,q,o,v,u,t){var p=new i(this,s,r,q,o,v,u,t);this.push(p);this.$grid.append(p.$imgDraggable)};f.prototype.doSwap=function(q,p){var r=[];r.push(this[q].getState());r.push(this[p].getState());this.future.length=0;this.history.push(r);this.historyCount(this.history.length);var o={x:this[q].x(),y:this[q].y()};this[q].x(this[p].x());this[q].y(this[p].y());this[q].setXY();this[p].x(o.x);this[p].y(o.y);this[p].setXY()};f.prototype.saveSelectedState=function(){var o=[];o.gridWidth=this.gridWidth();o.gridHeight=this.gridHeight();this.selection().map(function(p){o.push(p.getState())});this.future.length=0;this.history.push(o);this.historyCount(this.history.length)};f.prototype.disableUpdateSelected=false;f.prototype.updateSelected=function(){if(this.disableUpdateSelected){return}var q=-1,p=-1,r=0;for(var o=0;o<this.length;o++){if(this[o].selected()){r++;if(q==-1){q=o}else{if(p==-1){p=o}}}}this.selectedCount(r);if(this.swap()&&this.selectedCount()==2&&!this.modifyingState){this.doSwap(q,p);this.selectAll(false)}if(this.selectedCount()==1){this.selectedCard(this[q])}else{this.selectedCard(null)}};f.prototype.share=function(){var o=this;$.ajax({type:"POST",url:"save.php",data:{data:o.toLayoutVMF()},dataType:"json",success:function(p){if(p.error){alert("Save request failed.")}else{o.shareId(p.file)}},failure:function(p){alert("Save request failed.")}})};var d={"16x10":[1560,600,1158,440,70,70,66,66,120,1680,0,0.390228],"16x9":[1700,618,1208,440,72,72,68,68,220,1920,0,0.390228],"4x3":[1280,548,1034,450,58,58,54,54,0,1280,10,0.34848]};var b=new f(1700,618,1208,440,72,72,68,68),e=null;function n(o){o=o.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var q=new RegExp("[\\?&]"+o+"=([^&#]*)"),p=q.exec(location.search);return p==null?"":decodeURIComponent(p[1].replace(/\+/g," "))}function m(p){var o=new Blob([p],{type:"text/plain"});if(e!==null){window.URL.revokeObjectURL(e)}e=window.URL.createObjectURL(o);return e}function c(o,s){var q=o.target.files[0];if(q){var p=new FileReader();p.onload=function(t){var r=t.target.result;document.getElementById("upload-file").value=q.name;s(r)};p.readAsText(q)}else{alert("Failed to load file")}}function l(p){var o=this;o.width=p.width;o.height=p.height;o.gridWidth=p.gridWidth;o.gridHeight=p.gridHeight;o.gridShow=p.gridShow;o.aspectRatio=p.aspectRatio;o.swap=p.swap;o.snapSelection=p.snapSelection.bind(p);o.unsnapSelection=p.unsnapSelection.bind(p);o.swapSelection=p.swapSelection.bind(p);o.undo=p.undo.bind(p);o.redo=p.redo.bind(p);o.clearHistory=p.clearHistory.bind(p);o.historyCount=p.historyCount;o.cards=p;o.search=p.search;o.selectedCount=p.selectedCount;o.selectedCard=p.selectedCard;o.selectedCardX=ko.computed({read:function(){if(o.cards.selectedCount()>1){return"n/a"}if(o.selectedCard()!=null){return o.selectedCard().x()}return null},write:function(q){if(o.cards.selectedCount()>0){o.cards.setSelectedProperty("x",parseFloat(q))}},owner:this});o.selectedCardY=ko.computed({read:function(){if(o.cards.selectedCount()>1){return"n/a"}if(o.selectedCard()!=null){return o.selectedCard().y()}return null},write:function(q){if(o.cards.selectedCount()>0){o.cards.setSelectedProperty("y",parseFloat(q))}},owner:this});o.selectedCardZPos=ko.pureComputed({read:function(){if(o.cards.selectedCount()>1){return"n/a"}if(o.selectedCard()!=null){return o.selectedCard().zpos()}return null},write:function(q){if(o.cards.selectedCount()>0){o.cards.setSelectedProperty("zpos",parseFloat(q))}},owner:this});o.selectedCardScale=ko.pureComputed({read:function(){if(o.cards.selectedCount()>1){return"n/a"}if(o.selectedCard()!=null){return o.selectedCard().scale()}return null},write:function(q){if(o.cards.selectedCount()>0){o.cards.setSelectedProperty("scale",parseFloat(q))}},owner:this});o.backgroundImage=ko.computed(function(){return"url(background_"+p.aspectRatio()+".jpg)"});o.marginLeft=ko.computed(function(){return d[p.aspectRatio()][8]+"px"});o.backgroundWidth=ko.computed(function(){return d[p.aspectRatio()][9]+"px"});o.backgroundWidth2=ko.computed(function(){return(d[p.aspectRatio()][9]-10)+"px"});o.reset=p.resetSelected.bind(p);o.downloadLink=p.downloadLink;o.shareId=p.shareId;o.shareLink=ko.computed(function(){return"http://dev.devilesk.com/dota2/apps/layout-editor/?id="+o.shareId()});o.shareLayout=function(){if(p.shareId!=""){$("#share-link").fadeOut().fadeIn()}p.share()};o.exportLayout=function(){if(p.downloadLink!=""){$("#download-link").fadeOut().fadeIn()}p.downloadLink(m(p.toLayoutVMF()))};o.importLayout=function(q){p.parseVMF(q)};document.getElementById("import-layout").addEventListener("change",function(q){c(q,o.importLayout)},false)}var k={};$.getJSON("/media/js/herodata.json",function(q){for(key in q){if(key=="npc_dota_hero_abyssal_underlord"){continue}var p=q[key];k[p.HeroID]=p;b.add(key,p.displayname,p.HeroID)}var o=new l(b);ko.applyBindings(o);var r=n("id");if(r){$.get("save/"+r+".txt",function(s){b.parseVMF(s);if(n("canvas_only")){$(".controls-wrapper").remove();$("#instructions").remove();b.gridShow(false)}})}else{$.get("default_"+b.aspectRatio()+".txt",function(s){b.parseVMF(s);if(n("canvas_only")){$(".controls-wrapper").remove();$("#instructions").remove();b.gridShow(false)}})}});$("#selection-area").mousedown(function(o){if(b.swap()){return}if(!o.shiftKey&&!o.ctrlKey){b.selectAll(false)}$("#big-ghost").remove();$(".ghost-select").addClass("ghost-active");$(".ghost-select").css({left:o.pageX,top:o.pageY});initialW=o.pageX;initialH=o.pageY;$(document).bind("mouseup",h);$(document).bind("mousemove",a)});$(window).bind("mousewheel DOMMouseScroll",function(o){if(b.selectedCount()>0){if(o.originalEvent.wheelDelta>0||o.originalEvent.detail<0){b.nudgeScaleSelected(0.1)}else{b.nudgeScaleSelected(-0.1)}o.preventDefault()}});function h(t){$(document).unbind("mousemove",a);$(document).unbind("mouseup",h);var s=0;var p=5000;var r=0;var u=5000;var o=0;var q=new Array();b.state="selecting";b.disableUpdateSelected=true;$(".card").each(function(){var w=$(".ghost-select");var x=$(this);var v=j(w,x);if(v==true){this.card.selected(true)}});b.disableUpdateSelected=false;b.updateSelected();if(b.state="selecting"){b.state=null}$(".ghost-select").removeClass("ghost-active");$(".ghost-select").width(0).height(0)}function a(q){var o=Math.abs(initialW-q.pageX);var p=Math.abs(initialH-q.pageY);if((initialW+o>$(document).width()&&q.pageX>initialW)||(initialH+p>$(document).height()&&q.pageY>initialH)){return}$(".ghost-select").css({width:o,height:p});if(q.pageX<=initialW&&q.pageY>=initialH){$(".ghost-select").css({left:q.pageX})}else{if(q.pageY<=initialH&&q.pageX>=initialW){$(".ghost-select").css({top:q.pageY})}else{if(q.pageY<initialH&&q.pageX<initialW){$(".ghost-select").css({left:q.pageX,top:q.pageY})}}}}function j(p,o){var t=p.offset().top;var q=p.offset().left;var r=o.offset().top;var s=o.offset().left;return !(((t+p.height())<(r))||(t>(r+o.height()))||((q+p.width())<s)||(q>(s+o.width())))}function g(x,v,u,r,q,w,p,t,o,s){if(x.left<v.left){if(x.left<t){t=x.left}}else{if(v.left<t){t=v.left}}if(x.left+u>v.left+q){if(x.left>p){p=x.left+u}}else{if(v.left+q>p){p=v.left+q}}if(x.top<v.top){if(x.top<s){s=x.top}}else{if(v.top<s){s=v.top}}if(x.top+r>v.top+w){if(x.top>o){o=x.top+r}}else{if(v.top+w>o){o=v.top+w}}return{maxX:p,minX:t,maxY:o,minY:s}}})();